<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>ESP8266 Special: Apple&#39;s HomeKit is now for everyone! | [self writeBlog];</title>
<meta name="keywords" content="esp8266, dht11, dht22, homekit, mqtt, homekit2mqtt">
<meta name="description" content="Two weeks ago Apple held it&rsquo;s annual WWDC keynote announcing the latest updates to their platforms and technologies. The keynote lasted over 2 hours and you might would think that in that much time they have touched at least all technologies on the surface, but one thing especially seemed to have been missing almost entirely. HomeKit!
While Apple seemed to have not shown too much love to that topic during their Keynote, it seems as if they still have given that technology quite some thought leading up to WWDC as Apple quietly made quite a few changes.">
<meta name="author" content="Florian Harr">
<link rel="canonical" href="https://iflorian.com/esp8266-weather-station-homekit-special/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7a798bee3c08158f2ab5c87cad44e192b44f1a9f6625a4a82d811696d8a67786.css" integrity="sha256-enmL7jwIFY8qtch8rUThkrRPGp9mJaSoLYEWltimd4Y=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://iflorian.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://iflorian.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://iflorian.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://iflorian.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://iflorian.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://iflorian.com/esp8266-weather-station-homekit-special/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
  mermaid.initialize({ startOnLoad: true, theme: 'default' });
  mermaid.contentLoaded();
</script>
<meta property="og:url" content="https://iflorian.com/esp8266-weather-station-homekit-special/">
  <meta property="og:site_name" content="[self writeBlog];">
  <meta property="og:title" content="ESP8266 Special: Apple&#39;s HomeKit is now for everyone!">
  <meta property="og:description" content="Two weeks ago Apple held it’s annual WWDC keynote announcing the latest updates to their platforms and technologies. The keynote lasted over 2 hours and you might would think that in that much time they have touched at least all technologies on the surface, but one thing especially seemed to have been missing almost entirely. HomeKit!
While Apple seemed to have not shown too much love to that topic during their Keynote, it seems as if they still have given that technology quite some thought leading up to WWDC as Apple quietly made quite a few changes.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2017-06-21T11:20:26-04:00">
    <meta property="article:modified_time" content="2017-06-21T11:20:26-04:00">
    <meta property="article:tag" content="Esp8266">
    <meta property="article:tag" content="Dht11">
    <meta property="article:tag" content="Dht22">
    <meta property="article:tag" content="Homekit">
    <meta property="article:tag" content="Mqtt">
    <meta property="article:tag" content="Homekit2mqtt">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ESP8266 Special: Apple&#39;s HomeKit is now for everyone!">
<meta name="twitter:description" content="Two weeks ago Apple held it&rsquo;s annual WWDC keynote announcing the latest updates to their platforms and technologies. The keynote lasted over 2 hours and you might would think that in that much time they have touched at least all technologies on the surface, but one thing especially seemed to have been missing almost entirely. HomeKit!
While Apple seemed to have not shown too much love to that topic during their Keynote, it seems as if they still have given that technology quite some thought leading up to WWDC as Apple quietly made quite a few changes.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://iflorian.com/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ESP8266 Special: Apple's HomeKit is now for everyone!",
      "item": "https://iflorian.com/esp8266-weather-station-homekit-special/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ESP8266 Special: Apple's HomeKit is now for everyone!",
  "name": "ESP8266 Special: Apple\u0027s HomeKit is now for everyone!",
  "description": "Two weeks ago Apple held it\u0026rsquo;s annual WWDC keynote announcing the latest updates to their platforms and technologies. The keynote lasted over 2 hours and you might would think that in that much time they have touched at least all technologies on the surface, but one thing especially seemed to have been missing almost entirely. HomeKit!\nWhile Apple seemed to have not shown too much love to that topic during their Keynote, it seems as if they still have given that technology quite some thought leading up to WWDC as Apple quietly made quite a few changes.\n",
  "keywords": [
    "esp8266", "dht11", "dht22", "homekit", "mqtt", "homekit2mqtt"
  ],
  "articleBody": "Two weeks ago Apple held it’s annual WWDC keynote announcing the latest updates to their platforms and technologies. The keynote lasted over 2 hours and you might would think that in that much time they have touched at least all technologies on the surface, but one thing especially seemed to have been missing almost entirely. HomeKit!\nWhile Apple seemed to have not shown too much love to that topic during their Keynote, it seems as if they still have given that technology quite some thought leading up to WWDC as Apple quietly made quite a few changes.\nMost notably Apple opened up their HomeKit specs outside their MFi (Made for iPhone) program. If you’re a registered developer with Apple you won’t have to Google the specs anymore and rely on 3rd party info about HomeKit.\nNext in line are their changes to HomeKit’s requirements. Up until this point you had to have Apple’s Co-Processor á ka security chip installed in your HomeKit hardware to be able to produce HomeKit enabled hardware. They also dropped this, essentially removing licensing fees when releasing HomeKit hardware and making the process easier. Authentication that was done with Apple’s coprocessor can now be done via software authentication. You would still have to go through the MFi program if you intend to sell and publish HomeKit soft-/hardware but you would no longer have to buy Apple’s coprocess and pay licensing fees for those.\nPersonally, I value these two changes the most and think they’ll have a great impact in the availability of HomeKit enabled devices in the future.\nApart from that, Apple introduced changes to the featureset of their HomeKit platform, adding two new product categories (sprinklers and faucets), enhancements to the sunrise and sunset scenarios and adding temperature triggers.\nThis all might seem like basic stuff that doesn’t change much for us developers but it shows that Apple is aware of the huge IoT market and it’s potential.\nTo show off what this could potentially mean, let me bring back my ESP8266 based weather station that I introduce in my latest blog post installment here, part II and part III.\nLet’s say we wanted to sell this weather station as a real product. After all, hardware costs are very minimal and the software is top notch, but we would want to add HomeKit support so Siri could pick up the temperature from our Weather Station when asked. If we wanted to do this before Apple’s HomeKit changes we would have had to apply for their MFi program, acquire Apple’s co-processors and after we would have done all that the biggest hurdle would have been to pay licensing to Apple which would have probably killed our product.\nNow with these changes we could simply prototype HomeKit support ourselves. A good point to start off would be this GitHub project that we could connect to our MQTT server we’ve setup before, add a config for our weather station by creating a homekit2mqtt.json file with the following contents:\n{ \"TemperatureSensor\": { \"service\": \"TemperatureSensor\", \"name\": \"TemperatureSensor\", \"topic\": { \"statusTemperature\": \"weather/temperature\" }, \"manufacturer\": \"Generic\", \"model\": \"TemperatureSensor\" } } Now all we have to do is to run the homekit2mqtt bridge and we can start to use our weather station with HomeKit.\nIf our server runs and the connection can be made, we can start to add accessory in HomeKit:\nThe accessory is configured by default to be behind a bridge. Next is the actual temperature sensor:\nOnce we’ve added that, our temperature sensor should show up in our accessory list:\nAnd we can ask Siri for the temperature in the room we’ve assigned the sensor to:\nHomeKit integration was that easy and if we really would plan to sell our weather station including HomeKit integration we could start to implement HomeKit without the homekit2mqtt bridge according to the HomeKit Specification that Apple released and start the MFi process afterwards.\nApple really did a great thing here making HomeKit integration easier! I’m excited to see more equipment integrating with HomeKit soon!\n",
  "wordCount" : "670",
  "inLanguage": "en",
  "datePublished": "2017-06-21T11:20:26-04:00",
  "dateModified": "2017-06-21T11:20:26-04:00",
  "author":{
    "@type": "Person",
    "name": "Florian Harr"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://iflorian.com/esp8266-weather-station-homekit-special/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "[self writeBlog];",
    "logo": {
      "@type": "ImageObject",
      "url": "https://iflorian.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://iflorian.com/" accesskey="h" title="[self writeBlog]; (Alt + H)">[self writeBlog];</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://iflorian.com/contact" title="Contact">
                    <span>Contact</span>
                </a>
            </li>
            <li>
                <a href="https://iflorian.com/about" title="About me">
                    <span>About me</span>
                </a>
            </li>
            <li>
                <a href="https://iflorian.com/euc" title="EUC">
                    <span>EUC</span>
                </a>
            </li>
            <li>
                <a href="https://iflorian.com/" title="My Blog">
                    <span>My Blog</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      ESP8266 Special: Apple&#39;s HomeKit is now for everyone!
    </h1>
    <div class="post-meta"><span title='2017-06-21 11:20:26 -0400 -0400'>June 21, 2017</span>&nbsp;·&nbsp;<span>Florian Harr</span>

</div>
  </header> 
  <div class="post-content"><p>Two weeks ago Apple held it&rsquo;s annual WWDC keynote announcing the latest updates to their platforms and technologies. The keynote lasted over 2 hours and you might would think that in that much time they have touched at least all technologies on the surface, but one thing especially seemed to have been missing almost entirely. HomeKit!</p>
<p>While Apple seemed to have not shown too much love to that topic during their Keynote, it seems as if they still have given that technology quite some thought leading up to WWDC as Apple quietly made quite a few changes.</p>
<p>Most notably Apple opened up their HomeKit specs outside their MFi (Made for iPhone) program. If you&rsquo;re a registered developer with Apple you won&rsquo;t have to Google the specs anymore and rely on 3rd party info about HomeKit.</p>
<p>Next in line are their changes to HomeKit&rsquo;s requirements. Up until this point you had to have Apple&rsquo;s Co-Processor á ka security chip installed in your HomeKit hardware to be able to produce HomeKit enabled hardware. They also dropped this, essentially removing licensing fees when releasing HomeKit hardware and making the process easier. Authentication that was done with Apple&rsquo;s coprocessor can now be done via software authentication. You would still have to go through the MFi program if you intend to sell and publish HomeKit soft-/hardware but you would no longer have to buy Apple&rsquo;s coprocess and pay licensing fees for those.</p>
<p>Personally, I value these two changes the most and think they&rsquo;ll have a great impact in the availability of HomeKit enabled devices in the future.</p>
<p>Apart from that, Apple introduced changes to the featureset of their HomeKit platform, adding two new product categories (sprinklers and faucets), enhancements to the sunrise and sunset scenarios and adding temperature triggers.</p>
<p>This all might seem like basic stuff that doesn&rsquo;t change much for us developers but it shows that Apple is aware of the huge IoT market and it&rsquo;s potential.</p>
<p>To show off what this could potentially mean, let me bring back my ESP8266 based weather station that I introduce in my latest blog post installment <a href="https://iflorian.com/esp8266-weather-station-part-1">here</a>, <a href="https://iflorian.com/esp8266-weather-station-part-2">part II</a> and <a href="https://iflorian.com/esp8266-weather-station-part-3">part III</a>.</p>
<p>Let&rsquo;s say we wanted to sell this weather station as a real product. After all, hardware costs are very minimal and the software is top notch, but we would want to add HomeKit support so Siri could pick up the temperature from our Weather Station when asked. If we wanted to do this before Apple&rsquo;s HomeKit changes we would have had to apply for their MFi program, acquire Apple&rsquo;s co-processors and after we would have done all that the biggest hurdle would have been to pay licensing to Apple which would have probably killed our product.</p>
<p>Now with these changes we could simply prototype HomeKit support ourselves. A good point to start off would be this GitHub <a href="https://github.com/hobbyquaker/homekit2mqtt/wiki">project</a> that we could connect to our MQTT server we&rsquo;ve setup before, add a config for our weather station by creating a homekit2mqtt.json file with the following contents:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&#34;TemperatureSensor&#34;</span>: {
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&#34;service&#34;</span>: <span style="color:#e6db74">&#34;TemperatureSensor&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;TemperatureSensor&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&#34;topic&#34;</span>: {
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&#34;statusTemperature&#34;</span>: <span style="color:#e6db74">&#34;weather/temperature&#34;</span>
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&#34;manufacturer&#34;</span>: <span style="color:#e6db74">&#34;Generic&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&#34;model&#34;</span>: <span style="color:#e6db74">&#34;TemperatureSensor&#34;</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now all we have to do is to run the homekit2mqtt bridge and we can start to use our weather station with HomeKit.</p>
<p>If our server runs and the connection can be made, we can start to add accessory in HomeKit:</p>
<p><img alt="HomeKit Pair MQTT Bridge" loading="lazy" src="/images/2017/06/PairMQTTBridge.PNG"></p>
<p>The accessory is configured by default to be behind a bridge. Next is the actual temperature sensor:</p>
<p><img alt="HomeKit Pair Temperature Sensor" loading="lazy" src="/images/2017/06/PairTemperatureSensor.PNG"></p>
<p>Once we&rsquo;ve added that, our temperature sensor should show up in our accessory list:</p>
<p><img alt="HomeKit Showing Temperature Sensor" loading="lazy" src="/images/2017/06/HomeKitEquipment.PNG"></p>
<p>And we can ask Siri for the temperature in the room we&rsquo;ve assigned the sensor to:</p>
<p><img alt="HomeKit Siri Query" loading="lazy" src="/images/2017/06/AskingSiri.PNG"></p>
<p>HomeKit integration was that easy and if we really would plan to sell our weather station including HomeKit integration we could start to implement HomeKit without the homekit2mqtt bridge according to the HomeKit Specification that Apple released and start the MFi process afterwards.</p>
<p>Apple really did a great thing here making HomeKit integration easier! I&rsquo;m excited to see more equipment integrating with HomeKit soon!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://iflorian.com/tags/esp8266/">Esp8266</a></li>
      <li><a href="https://iflorian.com/tags/dht11/">Dht11</a></li>
      <li><a href="https://iflorian.com/tags/dht22/">Dht22</a></li>
      <li><a href="https://iflorian.com/tags/homekit/">Homekit</a></li>
      <li><a href="https://iflorian.com/tags/mqtt/">Mqtt</a></li>
      <li><a href="https://iflorian.com/tags/homekit2mqtt/">Homekit2mqtt</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>All rights reserved - 2024</span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><script>
(function() {
  'use strict';

  
  const aiContent = document.querySelectorAll('.ai-assisted');
  if (aiContent.length === 0) return;

  
  const STORAGE_KEY = 'ai-indicators-visible';
  const savedState = localStorage.getItem(STORAGE_KEY);
  const isVisible = savedState === 'true';

  
  if (isVisible) {
    document.body.classList.add('ai-indicators-visible');
  }

  
  const button = document.createElement('button');
  button.className = 'ai-toggle-btn';
  button.setAttribute('aria-label', 'Toggle AI content indicators');
  button.setAttribute('aria-pressed', isVisible);
  button.title = isVisible ? 'Hide AI indicators' : 'Show AI indicators';
  button.innerHTML = isVisible ? '✨ Hide AI' : '✨ Show AI';

  
  button.style.cssText = `
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    padding: 0.5rem 1rem;
    background: rgba(139, 92, 246, 0.9);
    color: white;
    border: none;
    border-radius: 2rem;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 500;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease;
    z-index: 1000;
    font-family: inherit;
  `;

  
  button.addEventListener('mouseenter', function() {
    this.style.background = 'rgba(139, 92, 246, 1)';
    this.style.transform = 'scale(1.05)';
  });

  button.addEventListener('mouseleave', function() {
    this.style.background = 'rgba(139, 92, 246, 0.9)';
    this.style.transform = 'scale(1)';
  });

  
  button.addEventListener('click', function() {
    const newState = !document.body.classList.contains('ai-indicators-visible');

    
    document.body.classList.toggle('ai-indicators-visible');

    
    button.setAttribute('aria-pressed', newState);
    button.title = newState ? 'Hide AI indicators' : 'Show AI indicators';
    button.innerHTML = newState ? '✨ Hide AI' : '✨ Show AI';

    
    localStorage.setItem(STORAGE_KEY, newState);
  });

  
  document.body.appendChild(button);

  
  button.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      this.click();
    }
  });
})();
</script>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
